---
title: 무한 횡스크롤 표현
created: 2024-03-19 10:44
last-updated: 2024-03-19 11:43
tags:
  - gameDev
  - toyproject
---

```ad-note
title: 키워드
- parallx scrolling
```

## 👯‍♂️ 무한 횡스크롤 어떻게 현 할 것인가?, Parallax Scroll

내 목표는 크롬 다이노 게임 허접한 버전을 만드는것이다 

| 크롬 다이노                             | parallax scroll이란                    | parallx scroll적용 유명게임                            |
| ---------------------------------- | ------------------------------------ | ------------------------------------------------ |
| ![](https://imgur.com/elhVFGM.png) | ![](https://i.imgur.com/NLnvbid.png) | ![](https://www.youtube.com/watch?v=3VdFCSR1kOI) |
|                                    |                                      |                                                  |


보면 티라노는 계속 뛰고 뒤의 구름도 반복해서 계속 나온다..이게 뭔가해서 찾아보니 이럴걸

> 찾아보니 패럴럭스 스크롤링이라고하는데 여러개의 배경 레이어가 있을 때 가장 앞에 있는 레이어의 속도가 빠르게 움직이고 뒤에 있는 레이어들은 갈수록 천천히 움직여 착시효과로 깊이감을 주는 기법을 말한다

내가 구현하고 싶은것은 여러개의 배경은 아니긴 하지만 검색하면 대부분의 유튜브에서 크롬 티라노 게임을 패럴럭스 스크롤링이라고 칭해서 그냥 그렇게 생각하기로했다…

![](https://imgur.com/7nUg6KV.png)



## 👯‍♂️ 무한히 계속 이어지는 땅을 만들자

- 배경은 가만히 있고 땅은 계속해서 나오게 만들어야한다
- 사실 이것도 되게 간단한 것 같다.. 그냥 뭔가  `땅*9999999` 이런식으로 할 순없나? 하지만 게임 화면내에서 보여 줄 수 있는게 한정적이니 말이 안되긴함
- 그러면 땅이 계속 반복해서 나오도록하자!

씬은 아래처럼 구성되어있고 
```
World(Node2D)
- Player(CharacterBody2D)
- GroundContainer(Node2D)
- ParallaxBackground(ParallaxBackground)
```
아래는 `GroundContainer` 씬과 연결된 스크립트이다.
```python
extends Node2D
const ground = preload("res://tile_map.tscn")
const groundwidth = 5785
var spawn_position = global_position
@onready var player = get_parent().get_node("Player")
# Called when the node enters the scene tree for the first time.
func _ready():

	pass

func _process(delta):
	if player.global_position.x > spawn_position.x - groundwidth: # Add 
		spawn_ground()


func spawn_ground():		
	var instance = ground.instantiate()
	add_child(instance)
	instance.global_position.x = spawn_position.x
	instance.global_position.y = 70
	spawn_position.x += groundwidth

# TODO! 처음에 인스턴스가 두개씩 생성돼서 강제로 삭제 화면에서 삭ㅈ제 부자연스러
	if get_child_count() > 2 :
		get_children()[0].queue_free()
```

코드를 자세히 보자면


```python
if player.global_position.x > spawn_position.x - groundwidth:
	spawn_ground()
```



1. 플레이어의 위치(`player.global_position.x`)가 특정 조건을 만족할 때 새로운 지면(`ground`)을 생성하는 로직이다.

여기서 조건은 `player.global_position.x`가 `spawn_position.x - groundwidth`인데
- `spawn_position` =>  :처음에는 이 groundcontainer 위치로 지정되고 지면이 생성될 위치를 저장하는 변수다
-  `groundwidth` =>  내가 미리 만들어 놓은 ground 스프라이트의 가로 길이
- player.global_position.x > spawn_position.x - groundwidth 는 플레이어가 지면의 오른쪽 끝에 다다랐을 때를 의미한다 

2. spawn_ground() 새로운 땅을 호출하는 함수

```python
func spawn_ground():		
	var instance = ground.instantiate()
	add_child(instance)
	instance.global_position.x = spawn_position.x
	instance.global_position.y = 70
	spawn_position.x += groundwidth
```

- `add_child(instance)`: 생성된 지면 인스턴스를 현재 노드의 자식으로 추가합니다. 이것은 Godot의 씬에서 새 지면을 실제로 추가한다
- . `instance.global_position.x = spawn_position.x`: 새로 생성된 지면 인스턴스의 전역 x 위치를 `spawn_position.x`로 설정
- `spawn_position.x += groundwidth`: 다음 지면이 생성될 x 위치를 업데이트


3. 화면에 두개의 땅이 있으면 안되므로 노드 자식(=땅)이 두개 생성되면 하나는 삭제
```python
if get_child_count() > 2 :
	get_children()[0].queue_free()
```


## 👯‍♂️ 타일맵에 Collision기능을 추가하자!

땅이 staticbody로 이루어진게 아니라 타일맵 자체에 collision 기능이 없었다 그래서 타일셋에서 직접 넣어줘야한다.

- 타일맵이용 + physicslayer를 추가해서 (이게 collision효과를줌) 

| 플레이어가 공중에 떠있는 것 같다                  | 디버그 모드를 보니...                        |
| ------------------------------------ | ------------------------------------ |
| ![](https://i.imgur.com/aVfSvLU.png) | ![](https://i.imgur.com/HSCcB8v.png) |

디버그 모드로 보니 collisionshape가 엄청두꺼워서 생긴 문제이다 따라서  
타일셋에서 collisionshape를 수정해준다  
이때 꼭 적용해주기!

| 적용전                                  | 적용후                                  |
| ------------------------------------ | ------------------------------------ |
| ![](https://i.imgur.com/TpmbvO8.png) | ![](https://i.imgur.com/sKWJTpL.png) |

성공!  
![](https://i.imgur.com/d5AqtdT.png)




--- 

## 👯‍♂️ Ref & LINKS TO THIS PAGE

- [유튜브, godot-parallax scrollling](https://youtu.be/1k0hKUtZrq0)
- https://youtube.com/shorts/S8vri9gxQHM?si=8ThaXBeYuUYb71nK


